version: "0.3"
predecessor: 3e084f80a230c8e3aa46e56ca555822ac14993de7ce2b5c5ed37a07684bdf893
name: mongodb-user-setup
services:
- name: dev
  image_name: mongodb-user-setup-image
  mrenclaves:
  - f9a9dab728f68775975a86f612363ae93c5495e9af00d231bcd1248462de5903
  command: /usr/bin/mongo /home/payload.js
  pwd: /
  environment:
    SCONE_MODE: hw
security:
  attestation:
    tolerate:
    - debug-mode
    - outdated-tcb
    ignore_advisories: '*'
secrets:
    - name: db_password
      kind: ascii
      size: 12
      export:
        - session: vault-dynamic
        - session: env-print
images:
    - name: mongodb-user-setup-image
      injection_files:
       - path: /home/payload.js
         content: |
              db = db.getSiblingDB('admin');
              db.createUser(
                {
                  user: "myUserAdmin",
                  pwd: "$$SCONE::db_password$$",
                  roles: [ { role: "userAdminAnyDatabase", db: "admin" } ]
                }
              )