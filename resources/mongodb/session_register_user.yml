version: "0.3"
predecessor: 54d4a280e891213f057e65f60bb877353e278370addd9df601126e2ebd1788d6
name: mongodb-user-setup
services:
- name: dev
  image_name: mongodb-user-setup-image
  mrenclaves:
  - f9a9dab728f68775975a86f612363ae93c5495e9af00d231bcd1248462de5903
  command: /usr/bin/mongo /home/payload.json
  pwd: /
  environment:
    SCONE_MODE: hw
security:
  attestation:
    tolerate:
    - debug-mode
    - outdated-tcb
    ignore_advisories: '*'
secrets:
    - name: db_password
      kind: ascii
      size: 12
      export:
        - session: vault-auto
        - session: env-print
images:
    - name: mongodb-user-setup-image
      injection_files:
       - path: /home/payload.js
         content: |
              db = db.getSiblingDB('admin');
              db.createUser(
                {
                  user: "myUserAdmin",
                  pwd: "$$SCONE::db_password$$",
                  roles: [ { role: "userAdminAnyDatabase", db: "admin" } ]
                }
              )