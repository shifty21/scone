version: "0.3"
name: mongodb-user-setup
services:
- name: dev
  image_name: mongodb-user-setup
  mrenclaves:
  - 78cbcad29089ea2f2cabfde4a41584bcc2e7e1ad103fbec3acac54593d87b7cf
  command: /usr/bin/mongo /home/payload.json
  pwd: /
  environment:
    SCONE_MODE: hw
security:
  attestation:
    tolerate:
    - debug-mode
    - outdated-tcb
    ignore_advisories: '*'
secrets:
    - name: db_password
      kind: ascii
      size: 12
      export:
        - session: vault-dynamic-secret
        - session: env-print
images:
    - name: mongodb-user-setup
      injection_files:
       - path: /home/payload.json
         content: |
              db = db.getSiblingDB('admin');
              db.createUser(
                {
                  user: "myUserAdmin",
                  pwd: "$$SCONE::db_password$$",
                  roles: [ { role: "userAdminAnyDatabase", db: "admin" } ]
                }
              )