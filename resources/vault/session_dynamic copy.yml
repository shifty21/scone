version: "0.3"
name: vault-dynamic-secret
services:
- name: dev
  image_name: vault-dynamic-secret-image
  mrenclaves:
  - 56d37ffa65f3aa0e83aad166aa2b339b2bdda20254617c4b3b8e3fa794c41991
  command: /root/go/bin/vault write database/config/admin \
    plugin_name=mongodb-database-plugin \
    allowed_roles="demo-client" \
    connection_url="mongodb://{{username}}:{{password}}@mongodb:27017/admin" \
    username="mydmin" \
    password="$$SCONE::mongodb_password$$"
  pwd: /
  environment:
    SCONE_MODE: hw
security:
  attestation:
    tolerate:
    - debug-mode
    - outdated-tcb
    ignore_advisories: '*'
secrets:
    - name: mongodb_password
      import:
        session: mongodb-user-setup
        secret: db_password
images:
    - name: vault-dynamic-secret-image
      injection_files:
       - path: /root/go/bin/resources/vault/payload.json
         content: |
           $$SCONE::gpg_private_from_parent1$$
